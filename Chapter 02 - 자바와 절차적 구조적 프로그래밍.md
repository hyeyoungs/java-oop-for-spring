# 02 자바와 절차적 구조적 프로그래밍
> 자바 코드가 메모리에서 어떻게 동작하는가?
## 자바 프로그램의 구동을 도와주는 친구들
- JDK: JVM SW Dev Tool
- JRE: JVM OS
- JVM: Virtual Computer
<br>
→ 자바 개발 도구인 JDK를 이용해 개발된 프로그램은 JRE에 의해 가상의 컴퓨터인 JVM 상에서 구동된다.       
  (Write Once Run Anywhere)    
<br>

## 프로그램과 메모리
- 코드 실행 영역
- 데이터 저장 영역 
  - static: 클래스의 놀이터 
  - stack: 메서드의 놀이터
    - 멀티 스레드: 스택 영역을 스래드 갯수만큼 분리
  - heap: 객체의 놀이터

<br>

## 자바와 메모리 로드 
### 전체
- main은 프로그램이 실행되는 시작점 
- JVM은 개발자가 작성한 모든 클래스와 임포트 패키지를 스태틱 영역에 배치 
- 메서드의 여는 중괄호 나올때마다 스택 프레임 생성 
- 메서드의 인자를 저장할 변수 공간을 스택 프레임의 맨 밑에 힐당 
- main 지역변수는 main 스택 프레임 안에 공간 마련 
- main안에 블록문(if 문)이 있다면 main 스택  프레임 안에 스택 프레임 할당
<br>

### 변수와 메모리
- 지역 변수 `in 스택 영역` : JVM은 `메서드 스택 프레임` 안에 밑에서부터 차곡차곡 지역 변수 공간을 마련한다.
- 클래스 멤버 변수 `in 스태틱 영역` : static 영역에서는 JVM이 종료될때까지 값이 존재한다.
- 객체 멤버 변수 `in 힙 영역` : heap에 속한 객체 맴버 변수는 GC가 처리한다.
- 전역변수는 스택 프레임에 독립적이다. static 영역에 배치된다.

<br>

### main() 메서드와 메모리
1. JRE는 먼저 프로그램 안에 main() 메서드가 있는지 확인한다.
2. JRE는 JVM을 부팅한다.
3. 부팅된 JVM은 목적 파일을 받아 그 목적 파일을 실행한다.<br> 
   (= java.lang 로딩, 각종 클래스 로딩, main()메서드 스택 프레임 배치, 변수 공간 배치)
   1) 가장 먼저 java.lang 패키지를 메모리의 스태틱 영역에 가져다 놓는다.
   2) 개발자가 작성한 모든 클래스와 import된 패키지를 메모리의 스태틱 영역에 가져다 놓는다.
   3) main() 메서드가 실행되기 위해 스택 프레임이 메모리의 스택 영역에 할당 된다. (메서드의 여는 증괄호마다 스택 프레임 생성)
   4) 메서드의 인자를 저장할 변수 공간을 스택 프레임의 맨 밑에 할당 한다.
   5) 닫는 중괄호을 만나면 스택 프레임이 소멸된다.
   6) main() 메서드가 끝나면 JVM이 할당한 메모리 소멸시키고, JVM을 종료하고, JRE 자체도 운영체제 상의 메모리에서 사라진다. 
    
<br>

### 블록 구분과 메모리: 블록 스택 프레임
- 메서드 내에서 블록문을 만나면 블록의 스택 프레임이 해당 메서드의 스택 프레임 안에 생성되고, <br> 
  블록문이 끝나면 블록의 스택 프레임이 사라진다.
- 그러므로, 외부 스택 프레임에서 내부 스택 프레임의 변수에 접근하는 것은 불가능하나 그 역은 가능하다. 

<br>

### 메서드 호출과 메모리: 메서드 스택 프레임
- 메서드 호출이 일어나면 호출되는 메서드의 스택 프레임이 메모리 스택 영역에 새로 생성되고, <br> 닫는 중괄호를 만나면 해당 메서드의 스택 프레임이 메모리에서 사라진다.
  - 메서드의 스택 프레임
    - 반환값을 저장할 변수 공간이 맨 아래,
    - 인자를 저장할 변수 공간이 그 다음,
    - 메서드의 지역 변수 공간은 마지막

<br>
  
### 전역 변수와 메모리
- 전역 변수 : 스택 프레임에 독립적이다. (지역 변수 : 스텍 프레임에 종속적)
- 가급적 전역 변수는 쓰지 않는 것이 좋다. 피해야 할 존재다.
  - Why? 프로젝트 규모에 따라 코드가 커지면서 여러 메서드에서 전역 변수의 값을 변경하기 시작하면, <br>메모리(JVM의 Runtime Data 영역)를 추적하지 않는 이상 전역 변수에 저장돼 있는 값을 파악하기 쉽지 않기 때문이다.
- 다만 읽기 전용으로 값을 공유해서 전역 상수로 쓰는 것은 적극 추천한다. ex PI

<br>

## Multi-Thread 환경에서의 개발
### 멀티 스레드 / 멀티 프로세스의 이해
- 멀티 프로세스는 다수의 데이터 저장 영역 (즉, 다수의 JVM의 RunTime Data 영역)을 갖는 구조다. 
- `멀티 스레드`의 메모리(JVM의 Runtime Data 영역) 모델은 `스택 영역을 스레드 갯수 만큼 분할`해서 쓰는 것이다.

<br>

- 멀티 프로세스는 하나의 프로세스가 다른 프로세스의 T메모리 영역을 절대 침범 할 수 없는 안전한 구조이지만, 메모리 사용량은 그만큼 크다.
- 멀티 스레드는 하나의 T메모리 (= 데이터 저장 영역) 안에서 스택 영역만 분할한 것이기 때문에 <br>하나의 스레드에서 다른 스레드의 스택 영역에는 접근할 수 없지만 스태틱 영역과 힙 영역은 공유해서 사용하는 구조다. <br>따라서 멀티 프로세스 대비 메모리를 적게 사용할 수 있다.

<br>

- 서블릿은 요청당 프로세스가 아닌 요청당 스레드를 생성한다. (훨씬 효율적이기 때문이다.)
- 쓰기 가능한 전역 변수를 사용하면 스레드의 안정성이 깨진다.

<br>

# 읽은 후 알게된 개념과 소감
- 데이터 저장 영역
  - 스태틱 : 클래스의 놀이터
  - 스택 : 메서드의 놀이터
    - 멀티 스레드 : 스택 영역을 스래드 갯수만큼 분리
  - 힙 : 객체의 놀이터
- `메서드를 호출하면서 인자로 전달되는 것`은 변수 자체가 아니라 `변수가 저장한 값만을 복제해서 전달한다.` 
- 전역 변수는 읽기 전용으로 값을 공유해서 전역 상수로 쓰는 경우 외에는 사용하지 말자.
- 자바 코드가 메모리에서 어떻게 동작하는지 이해를 하게 되었다.
